---
title: "Personal Effects of Nutrition"
output:
  html_document: default
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE, fig.align="center")

# Load common MEBN package
source("mebn/MEBN.r")
```

This notebook provides a reproducible modelling of nutrional effects that is the main contribution of the article. The article provides more theory, but the experiment is here in detail.

(This should go to theory part in paper..)

- What kind on process we are modelling?
  - Biometric data is usually more multiplicative than additive. This is why log-normal distribution makes sense.
  - The nutritional reactions form an interconnected system. We propose to model the system with a directed acyclic graph (DAG) while having only the nutrients affecting the blood test values. When this DAG describes a joint probability distribution, it is called a Bayesian Network. The joint propability distribution can furhermore factorized into local distributions with blood tests as responses and nutrients in diet its predictors. 

**Assumptions for local distributions**

  - Linear
  - Response time
  - Multi-response

## Data

Data description

```{r load_data, echo=FALSE, message=FALSE}

# Read the data description
datadesc <- read.csv(file="Data description.csv", header = TRUE, sep = ";")

# Read the actual data matching the description
sysdimet <- read.csv(file="data/SYSDIMET_diet.csv", sep=";", dec=",")

# Define how to iterate through the graph
assumedpredictors <- datadesc[datadesc$Order==100,]    
assumedtargets <- datadesc[datadesc$Order==200,] 

```

When constructing the BN we iterate through all the target nodes (the blood tests) can estimate their local probability distributions given all the nutrients at the patient's diet.

- Pruning insignificant nutrients with a horseshow prior. Projpred could be also used.


```{r}

```

## Checking the fit of the local models


## Principal components

After finding a reasonable fit, we can analyze the principal components that explain the variation.

## Pruning the graph

- Remove the insignicant components: more informative graph and multiresponse

## Inference

- Personal graph
- Clusters of similar reactions types







